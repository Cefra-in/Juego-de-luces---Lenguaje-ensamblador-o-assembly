/*
 * proyecto_juego_de_luces.asm
 *
 *  Created: 30/01/2014 11:08:35
 *   Author: EfRaiN
 */ 
	.include "m8def.inc"
	.cseg
	.org 0x0000
	LDI R16,LOW(RAMEND)
	OUT SPL,R16
	LDI R16,HIGH(RAMEND)
	OUT SPH,R16
//--------------------------
INICIO:
	LDI R16,$FF
	OUT DDRD,R16
	LDI R16,$00
	OUT DDRC,R16
//--------------------------
	LDI R19,$00
	OUT PORTD,R19
CONTROL:
	IN R23,PINC
	SBIC PINC,PC0
	RJMP ALTERNO_
	SBIC PINC,PC1
	RJMP JUEGO_
	SBIC PINC,PC2
	RJMP DERECHA_
	SBIC PINC,PC3
	RJMP IZQUIERDA_
	RJMP CONTROL_
ALTERNO_:
	LDI R19,1
	RJMP CONTROL_
JUEGO_:
	LDI R19,2
	RJMP CONTROL_
DERECHA_:
	LDI R19,3
	RJMP CONTROL_
IZQUIERDA_:
	LDI R19,4
	RJMP CONTROL_
CONTROL_:
	CPI R19,1
	BREQ ALTERNO
	CPI R19,2
	BREQ JUEGO
	CPI R19,3
	BREQ DERECHA
	CPI R19,4
	BREQ IZQUIERDA
	RJMP CONTROL
ALTERNO:
	LDI R17,0b01010101
	OUT PORTD,R17
	RCALL RETARDO_200ms
	LDI R17,0b10101010
	OUT PORTD,R17
	RCALL RETARDO_200ms
	LDI R17,$00
	OUT PORTD,R17
	RJMP CONTROL
JUEGO:
	CPI R17,$00
	BRNE BUCLE_J
INICIO_J:
	LDI R16,0b10000000
	LDI R17,0b00000001
BUCLE_J:
	MOV R18,R17
	OR R18,R16
	OUT PORTD,R18
	RCALL RETARDO_200ms
	SBIC PIND,PD4
	RJMP SALTO
	LSR R16
	LSL R17
	CPI R16,0b00000001
	BREQ INICIO_J
	RJMP CONTROL
SALTO:
	LDI R16,0b00000100
	LDI R17,0b00100000
	RJMP BUCLE_J
DERECHA:
	CPI R17,$00
	BRNE BUCLE_D
INICIO_D:
	LDI R17,0b10000000
BUCLE_D:
	OUT PORTD,R17
	RCALL RETARDO_200ms
	LSR R17
	CPI R17,0b00000000
	BREQ INICIO_D
	RJMP CONTROL
IZQUIERDA:
	CPI R17,$00
	BRNE BUCLE_I
INICIO_I:
	LDI R17,0b00000001
BUCLE_I:
	OUT PORTD,R17
	RCALL RETARDO_200ms
	LSL R17
	CPI R17,0b00000000
	BREQ INICIO_I
	RJMP CONTROL

RETARDO_200ms:		;retardo de 200ms
	ldi R20,20
WGLOOP0:
	ldi R21,$21
WGLOOP1:
	ldi R22,$64
WGLOOP2:
	dec R22
    brne WGLOOP2
    dec R21
    brne WGLOOP1
	dec R20
	brne WGLOOP0
	ret